<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nertz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.5.1/pixi.min.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font: 13px Helvetica, Arial; }
        form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
        form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
        form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
        #messages { list-style-type: none; margin: 0; padding: 0; }
        #messages li { padding: 5px 10px; }
        #messages li:nth-child(odd) { background: #eee; }
        #messages { margin-bottom: 40px }
    </style>
</head>
<body>
Hello, This is dog
<ul id="messages"></ul>
<form action="">
    <input id="m" autocomplete="off" /><button>Send</button>
</form>
<script type="application/javascript">

    $(function () {
        var socket = io();
        $('form').submit(function(){
            socket.emit('chat message', $('#m').val());
            $('#m').val('');
            return false;
        });
        socket.on('chat message', function(msg){
            $('#messages').append($('<li>').text(msg));
            window.scrollTo(0, document.body.scrollHeight);
        });
    });


    // The application will create a renderer using WebGL, if possible,
    // with a fallback to a canvas render. It will also setup the ticker
    // and the root stage PIXI.Container.
    var app = new PIXI.Application(800, 600, {backgroundColor : 0x1099bb});

    // The application will create a canvas element for you that you
    // can then insert into the DOM.
    document.body.appendChild(app.view);

    PIXI.loader.add('cardTiles', 'cards.png').load(setup);

    function setup(loader, resources) {

        // cards are 98 px tall, 73 wide
        var texture = PIXI.utils.TextureCache["cards.png"];

        //Create a rectangle object that defines the position and
        //size of the sub-image you want to extract from the texture
        var rectangle = new PIXI.Rectangle(192, 128, 64, 64);

        var cardW = 73;
        var cardH = 98;
        var cardFace = 11;
        var cardSuit = 3;
        var rectangle = new PIXI.Rectangle((cardFace * cardW), (cardSuit * cardH), cardW, cardH);

        //Tell the texture to use that rectangular section
        texture.frame = rectangle;

        //Create the sprite from the texture
        var rocket = new PIXI.Sprite(texture);

        //Position the rocket sprite on the canvas
        rocket.x = 88;
        rocket.y = 148;

        //Add the rocket to the stage
        app.stage.addChild(rocket);

        //Render the stage
//        app.renderer.render(stage);


        rocket.anchor.x = 0.5;
        rocket.anchor.y = 0.5;

        // enable the bunny to be interactive... this will allow it to respond to mouse and touch events
        rocket.interactive = true;

        // this button mode will mean the hand cursor appears when you roll over the bunny with your mouse
        rocket.buttonMode = true;

        rocket
            .on('pointerdown', onDragStart)
            .on('pointerup', onDragEnd)
            .on('pointerupoutside', onDragEnd)
            .on('pointermove', onDragMove);

        app.ticker.add(function(delta) {
            // just for fun, let's rotate mr rabbit a little
            // delta is 1 if running at 100% performance
            // creates frame-independent tranformation
            rocket.rotation += -0.01 * delta;
        });

    }

    function onDragStart(event) {
        // store a reference to the data
        // the reason for this is because of multitouch
        // we want to track the movement of this particular touch
        this.data = event.data;
        this.alpha = 0.5;
        this.dragging = true;
    }

    function onDragEnd() {
        this.alpha = 1;
        this.dragging = false;
        // set the interaction data to null
        this.data = null;
        var socket = io();
        socket.emit('chat message', 'The Card was dropped');
    }

    function onDragMove() {
        if (this.dragging) {
            var newPosition = this.data.getLocalPosition(this.parent);
            this.x = newPosition.x;
            this.y = newPosition.y;
        }
    }

    // load the texture we need
//    PIXI.loader.add('bunny', 'bunny.png').load(function(loader, resources) {
//
//        // This creates a texture from a 'bunny.png' image.
//        var bunny = new PIXI.Sprite(resources.bunny.texture);
//
//        // Setup the position of the bunny
//        bunny.x = app.renderer.width / 2;
//        bunny.y = app.renderer.height / 2;
//
//        // Rotate around the center
//        bunny.anchor.x = 0.5;
//        bunny.anchor.y = 0.5;
//
//        // Add the bunny to the scene we are building.
//        app.stage.addChild(bunny);
//
//        // Listen for animate update
//        app.ticker.add(function(delta) {
//            // just for fun, let's rotate mr rabbit a little
//            // delta is 1 if running at 100% performance
//            // creates frame-independent tranformation
//            bunny.rotation += 0.1 * delta;
//        });
//    });

</script>
</body>
</html>